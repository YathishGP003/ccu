From 1d841a841a4a0e7fac8d251cece0b1bb9d2a2873 Mon Sep 17 00:00:00 2001
From: Samjith Sadasivan <samjith@75f.io>
Date: Wed, 14 Dec 2022 14:51:49 +0530
Subject: [PATCH] DAB pulse fix

---
 .../java/a75f/io/logic/pubnub/DamperReheatTypeHandler.java  | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/logic/src/main/java/a75f/io/logic/pubnub/DamperReheatTypeHandler.java b/logic/src/main/java/a75f/io/logic/pubnub/DamperReheatTypeHandler.java
index 0e6e82f13..653cc6c27 100644
--- a/logic/src/main/java/a75f/io/logic/pubnub/DamperReheatTypeHandler.java
+++ b/logic/src/main/java/a75f/io/logic/pubnub/DamperReheatTypeHandler.java
@@ -41,7 +41,7 @@ public class DamperReheatTypeHandler {
             if (typeVal == 0) {
                 SmartNode.setPointEnabled(address, Port.RELAY_ONE.name(), false );
                 SmartNode.setPointEnabled(address, Port.RELAY_TWO.name(), false );
-            } else if (typeVal <= ReheatType.OneStage.ordinal()) {
+            } else if ((typeVal - 1) <= ReheatType.Pulse.ordinal()) {
                 //Modulating Reheat -> Enable AnalogOut2 and disable relays
                 SmartNode.updatePhysicalPointType(address, Port.ANALOG_OUT_TWO.toString(), ReheatType.values()[typeVal-1].displayName);
                 SmartNode.setPointEnabled(address, Port.ANALOG_OUT_TWO.toString(), true);
@@ -51,7 +51,7 @@ public class DamperReheatTypeHandler {
                 SmartNode.updatePhysicalPointType(address, Port.RELAY_ONE.toString(),
                         OutputRelayActuatorType.NormallyClose.displayName);
                 SmartNode.setPointEnabled(address, Port.RELAY_ONE.toString(), true);
-                if (typeVal >= ReheatType.TwoStage.ordinal()) {
+                if ((typeVal - 1)  == ReheatType.TwoStage.ordinal()) {
                     SmartNode.updatePhysicalPointType(address, Port.RELAY_TWO.toString(), OutputRelayActuatorType.NormallyClose.displayName);
                     SmartNode.setPointEnabled(address, Port.RELAY_TWO.toString(), true);
                 }
@@ -73,7 +73,7 @@ public class DamperReheatTypeHandler {
                 SmartNode.updatePhysicalPointType(address, Port.RELAY_ONE.toString(),
                                                   OutputRelayActuatorType.NormallyClose.displayName);
                 SmartNode.setPointEnabled(address, Port.RELAY_ONE.toString(), true);
-                if (typeVal == ReheatType.TwoStage.ordinal() + 1) {
+                if (typeVal == ReheatType.TwoStage.ordinal()) {
                     SmartNode.updatePhysicalPointType(address, Port.RELAY_TWO.toString(), OutputRelayActuatorType.NormallyClose.displayName);
                     SmartNode.setPointEnabled(address, Port.RELAY_TWO.toString(), true);
                 }
-- 
2.37.3

