From 9a6fb6342a2dfea08825694ac7a4b003993c0b34 Mon Sep 17 00:00:00 2001
From: Samjith Sadasivan <samjith@75f.io>
Date: Fri, 2 Sep 2022 00:33:00 +0530
Subject: [PATCH] Remove connection reset on sse closure

---
 .../src/main/java/a75f/io/logic/messaging/MessagingAckJob.java | 3 ++-
 .../main/java/a75f/io/logic/messaging/MessagingListener.java   | 3 +--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/logic/src/main/java/a75f/io/logic/messaging/MessagingAckJob.java b/logic/src/main/java/a75f/io/logic/messaging/MessagingAckJob.java
index ed457db7f..a86a6b137 100644
--- a/logic/src/main/java/a75f/io/logic/messaging/MessagingAckJob.java
+++ b/logic/src/main/java/a75f/io/logic/messaging/MessagingAckJob.java
@@ -36,7 +36,8 @@ public class MessagingAckJob {
     public void doJob() {
         CcuLog.d(L.TAG_CCU_MESSAGING, "Doing Ack Job");
 
-        if (!MessagingClient.getInstance().isSubscribed() && ConnectionUtil.isNetworkConnected()) {
+        if (!MessagingClient.getInstance().isSubscribed()) {
+            CcuLog.d(L.TAG_CCU_MESSAGING, "Not subscribed , reset connection");
             MessagingClient.getInstance().resetMessagingConnection();
             return;
         }
diff --git a/logic/src/main/java/a75f/io/logic/messaging/MessagingListener.java b/logic/src/main/java/a75f/io/logic/messaging/MessagingListener.java
index ccbab8062..083861168 100644
--- a/logic/src/main/java/a75f/io/logic/messaging/MessagingListener.java
+++ b/logic/src/main/java/a75f/io/logic/messaging/MessagingListener.java
@@ -89,8 +89,7 @@ public class MessagingListener implements ServerSentEvent.Listener {
 
     @Override
     public void onClosed(ServerSentEvent sse) {
-        CcuLog.i(L.TAG_CCU_MESSAGING, "SSE Socket Closed : resetMessagingConnection");
-        MessagingClient.getInstance().resetMessagingConnection();
+        CcuLog.i(L.TAG_CCU_MESSAGING, "SSE Socket Closed");
     }
 
     private boolean isRestartCommand(JsonElement messageContents) {
-- 
2.32.1 (Apple Git-133)

