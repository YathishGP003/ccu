package a75f.io.device.mesh;

/**
 * Created by samjithsadasivan on 12/13/18.
 */

public class ThermistorUtil
{

    public static double[] resistance = { 878900 ,617590 ,439340 ,316180 ,230060 ,216070 ,203037 ,190889 ,179559 ,169150 ,159180 ,149872 ,
            141177 ,133051 ,125550 ,118385 ,111681 ,105406 ,99529 ,94143 ,88947 ,84075 ,79505 ,75216 ,71172 ,67378 ,63812 ,
            60461 ,57309 ,54308 ,51464 ,48788 ,46270 ,43900 ,41505 ,39410 ,37434 ,35571 ,33814 ,32014 ,30458 ,28989 ,27600 ,
            26287 ,25011 ,23819 ,22692 ,21626 ,20617 ,19691 ,18790 ,17936 ,17127 , 16359 ,15618 ,14918 ,14254 ,13624 ,13026 ,
            12474 ,11927 ,11407 ,10914 ,10444 ,10000 ,9580 ,9181 ,8801 ,8439 ,8080 ,7749 ,7433 ,7132 , 6845 ,6569 ,6306 ,6055 ,
            5816 ,5587 ,5372 ,5162 ,4961 ,4770 ,4587 ,4424 ,4255 ,4094 ,3939 ,3792 ,3661 ,3525 ,3395 ,3270 ,3151 , 3039 ,2929 ,
            2824 ,2723 ,2626 ,2536 ,2446 ,2361 ,2278 ,2200 ,2128 ,2055 ,1985 ,1918 ,1853 ,1794 ,1734 ,1677 ,1622 ,1569 ,1518 ,
            1469 ,1422 ,1376 ,1333 ,1290 ,1250 ,1211 ,1173 ,1137 ,1100 ,1067 ,1034 ,1003 ,973 ,942 ,913 ,885 ,859 ,833 ,809 ,
            785 ,762 ,740 ,718 ,697 ,677 ,658 ,640 ,622 ,604 ,587 ,570 ,554 ,538 ,525 ,510 ,496 ,483 ,470 ,457 ,445 ,433 ,422 ,
            411 ,400 ,389 ,379 ,369 ,359 ,351 ,342 ,333 ,324 ,316 ,308 ,301 ,293 ,285 ,278 ,272 ,265 ,259 ,252 ,246 ,240 ,235 ,
            229 ,224 ,219 ,213 ,208 ,203 ,198 ,194 ,189 ,184 ,180 ,176 ,172 ,168 };

    public static double[] temperature = {-67,-58,-49,-40,-31,-29.2,-27.4,-25.6,-23.8,-22,-20.2,-18.4,-16.6,-14.8,-13,-11.2,-9.4,-7.6,-5.8,
            -4,-2.2,-0.4,1.4,3.2,5,6.8,8.6,10.4,12.2,14,15.8,17.6,19.4,21.2,23,24.8,26.6,28.4,30.2,32,33.8,35.6,37.4,39.2,41,42.8,
            44.6,46.4,48.2,50,51.8,53.6,55.4,57.2,59,60.8,62.6,64.4,66.2,68,69.8,71.6,73.4,75.2,77,78.8,80.6,82.4,84.2,86,87.8,89.6,
            91.4,93.2,95,96.8,98.6,100.4,102.2,104,105.8,107.6,109.4,111.2,113,114.8,116.6,118.4,120.2,122,123.8,125.6,127.4,129.2,131,
            132.8,134.6,136.4,138.2,140,141.8,143.6,145.4,147.2,149,150.8,152.6,154.4,156.2,158,159.8,161.6,163.4,165.2,167,168.8,170.6,
            172.4,174.2,176,177.8,179.6,181.4,183.2,185,186.8,188.6,190.4,192.2,194,195.8,197.6,199.4,201.2,203,204.8,206.6,208.4,210.2,
            212,213.8,215.6,217.4,219.2,221,222.8,224.6,226.4,228.2,230,231.8,233.6,235.4,237.2,239,240.8,242.6,244.4,246.2,248,249.8,
            251.6,253.4,255.2,257,258.8,260.6,262.4,264.2,266,267.8,269.6,271.4,273.2,275,276.8,278.6,280.4,282.2,284,285.8,287.6,
            289.4,291.2,293,294.8,296.6,298.4,300.2,302,303.8,305.6,307.4,309.2,311};
    
    public static double getThermistorValueToTemp(double rawValue) {
        int leftIndex = 0;
        int rightIndex = resistance.length - 1;
        if (rawValue >= resistance[leftIndex])
            return temperature[leftIndex];
        else if (rawValue <= resistance[rightIndex])
            return temperature[rightIndex];
        
        boolean found = false;
        while (!found) {
            if (rightIndex == leftIndex + 1) {
                return (temperature[leftIndex] +
                        (rawValue - resistance[leftIndex]) / (resistance[rightIndex] - resistance[leftIndex]) * (temperature[rightIndex] - temperature[leftIndex]));
            } else {
                int midIndex = (int) (leftIndex + rightIndex) / 2;
                if (rawValue == resistance[midIndex])
                    return temperature[midIndex];
                else {
                    if (rawValue > resistance[midIndex]) {
                        rightIndex = midIndex;
                    } else {
                        leftIndex = midIndex;
                    }
                }
            }
        }
        return 0;
    }
}
